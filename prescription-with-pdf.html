<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prescription Details</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f5f5f5;
        }

        .pdf-container {
            width: 21cm;
            height: 29.7cm;
            background-color: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            page-break-after: always;
            position: relative;
        }

        .pdf-container:last-child {
            page-break-after: avoid;
        }

        .header,
        .footer-text {
            background-color: #1B3F6D;
            color: white;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            flex-shrink: 0;
        }

        .header-left {
            display: flex;
            flex-direction: column;
        }

        .header img {
            width: 120px;
            margin-bottom: 70px;
        }

        .header-title {
            font-size: 16px;
            font-weight: 600;
            margin-top: 8px;
        }

        .clinic-details {
            text-align: right;
            line-height: 1.4;
        }

        .clinic-details p {
            font-size: 12px;
            margin: 2px 0;
        }

        .details-container {
            display: flex;
            justify-content: space-between;
            padding: 15px 20px;
            margin-top: 8px;
            align-items: stretch;
            flex-shrink: 0;
        }

        .details-box {
            width: 48%;
            display: flex;
            flex-direction: column;
            font-size: 12px;
        }

        .patient-details,
        .appointment-details {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 15px;
            background-color: #F3F9FF;
            border-radius: 5px;
            flex-grow: 1;
        }

        .details-heading {
            font-size: 13px;
            font-weight: 400;
            margin-bottom: 10px;
            color: #242424;
        }

        .patient-details p,
        .appointment-details p {
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }

        .patient-details strong,
        .appointment-details strong,
        .age {
            min-width: 140px;
            text-align: left;
            font-weight: 500;
        }

        .patient-details span,
        .appointment-details span,
        .age-value {
            flex-grow: 1;
            text-align: left;
            color: #1B3F6D;
        }

        .dob-age {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 30px;
        }

        /* Prescription table container with dynamic height */
        .prescription-table-container {
            padding: 0 20px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }

        .prescription-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
            flex-grow: 1;
        }

        .prescription-table th {
            background-color: #1B3F6D;
            color: white;
            font-size: 12px;
            padding: 8px;
            text-align: left;
            height: 40px;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .prescription-table td {
            font-size: 12px;
            padding: 8px;
            text-align: left;
            vertical-align: top;
            border-bottom: 1px solid #eee;
            word-wrap: break-word;
        }

        .prescription-table th:nth-child(1),
        .prescription-table td:nth-child(1) {
            width: 8%;
        }

        .prescription-table th:nth-child(2),
        .prescription-table td:nth-child(2) {
            width: 48%;
        }

        .prescription-table th:nth-child(3),
        .prescription-table td:nth-child(3) {
            width: 14%;
        }

        .prescription-table th:nth-child(4),
        .prescription-table td:nth-child(4) {
            width: 14%;
        }

        .prescription-table th:nth-child(5),
        .prescription-table td:nth-child(5) {
            width: 10%;
        }

        .medicine-details {
            display: flex;
            flex-direction: column;
            font-size: 10px;
        }

        .medicine-instruction {
            font-size: 10px;
            color: #1B3F6D;
            margin-top: 3px;
        }

        .prescribed-by {
            padding: 20px;
            flex-shrink: 0;
        }

        .prescribed-by-title {
            font-size: 13px;
            font-weight: 400;
            margin-bottom: 5px;
            color: #242424;
        }

        .doctor-details {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }

        .doctor-details table {
            width: 100%;
            font-size: 12px;
            border-collapse: collapse;
        }

        .doctor-details table th,
        .doctor-details table td {
            background-color: #f3f9ff;
            padding: 5px;
            text-align: left;
            vertical-align: top;
            word-wrap: break-word;
        }

        .doctor-details table td {
            color: #1B3F6D;
        }

        .doctor-details table th {
            background-color: #f3f9ff;
            width: 25%;
        }

        .qr-signature-container {
            display: flex;
            padding: 0 20px;
            flex-shrink: 0;
        }

        .qr-container {
            width: 80px;
            height: 80px;
            margin-right: 20px;
            flex-shrink: 0;
        }

        .qr-container img {
            width: 100%;
        }

        .qr-container p {
            margin-top: 3px;
            font-size: 10.2px;
        }

        .signature-section {
            font-size: 11px;
            color: #333;
        }

        .signature-section p {
            margin: 5px 0;
            line-height: 1.5;
        }

        .footer-text {
            font-size: 11px;
            text-align: justify;
            padding: 15px 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }

        .footer-text p {
            line-height: 1.5;
        }

        .medicine-name {
            display: block;
            line-height: 1.4;
            white-space: normal;
            overflow: visible;
            margin-bottom: 4px;
            font-size: 12px;
        }

        .truncate-text {
            max-height: none;
            overflow: visible;
            word-break: break-word;
        }

        /* Page break styles */
        .page-break {
            page-break-before: always;
        }

        .prescription-page {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        /* Responsive table for overflow */
        .table-wrapper {
            flex-grow: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .table-content {
            flex-grow: 1;
            overflow-y: auto;
        }

        /* Print styles */
        @media print {
            body {
                background-color: white;
            }
            
            .pdf-container {
                box-shadow: none;
                margin: 0;
                width: 100%;
                height: 100vh;
            }
            
            .page-break {
                page-break-before: always;
            }
        }

        /* Dynamic row height calculation */
        .prescription-table tbody tr {
            min-height: 40px;
        }

        .prescription-table tbody tr td {
            vertical-align: top;
            padding: 8px;
        }
    </style>
</head>

<body>
    <div class="pdf-container prescription-page">
        <div class="header">
            <div class="header-left">
                <img src="https://d2pznqasld4zpy.cloudfront.net/common/WebLogo.svg" alt="SendScript">
                <div class="header-title">Private Prescription</div>
            </div>

            <div class="clinic-details">
                <p>
                    <strong>
                        Sample Medical Centre
                    </strong>
                </p>
                <p>
                    123 Medical Street, Suite 100
                </p>
                <p>
                    London
                </p>
                <p>
                    SW1A 1AA
                </p>
                <p>Tel: +44 20 1234 5678</p>
                <p>Email: clinic@sendscript.com</p>
            </div>
        </div>

        <div class="details-container">
            <div class="details-box">
                <div class="details-heading">Patient Details</div>
                <div class="patient-details">
                    <p><strong>Patient Name:</strong> <span>Mr. John Doe</span></p>
                    <p class="dob-age">
                        <strong>Date Of Birth:</strong>
                        <span>
                            15/01/1990
                            <span class="age" style="color: #000; font-weight: 500; margin-left: 10px;">Age:</span>
                            <span class="age-value">34</span>
                        </span>
                    </p>
                    <p><strong>Mobile Number:</strong> <span>+44 7123 456789</span></p>
                    <p><strong>Address:</strong>
                        <span>
                            789 Patient Avenue, Apt 10, London, SW3C 3CC<br>
                            United Kingdom
                        </span>
                    </p>
                </div>
            </div>

            <div class="details-box">
                <div class="details-heading">Prescription Details</div>
                <div class="appointment-details">
                    <p><strong>Prescription ID:</strong> <span>RX-2024-001234</span></p>
                    <p><strong>Date:</strong> <span>15/12/2024</span></p>
                </div>
            </div>
        </div>

        <!-- Prescription Table Container -->
        <div class="prescription-table-container">
            <div class="table-wrapper">
                <div class="table-content">
                    <table class="prescription-table">
                        <thead>
                            <tr>
                                <th>SL No</th>
                                <th>Medicine</th>
                                <th>Duration</th>
                                <th>Method</th>
                                <th>Quantity</th>
                            </tr>
                        </thead>
                        <tbody id="prescription-tbody">
                            <!-- Sample prescription items -->
                            <tr>
                                <td>1</td>
                                <td>
                                    <div class="medicine-details">
                                        <span class="medicine-name truncate-text">Paracetamol 500mg Tablets</span>
                                        <span class="medicine-instruction">- Take 1-2 tablets every 4-6 hours as needed for pain relief</span>
                                    </div>
                                </td>
                                <td>7 days</td>
                                <td>Oral</td>
                                <td>16 tablets</td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>
                                    <div class="medicine-details">
                                        <span class="medicine-name truncate-text">Ibuprofen 400mg Tablets</span>
                                        <span class="medicine-instruction">- Take 1 tablet every 6-8 hours with food to reduce inflammation</span>
                                    </div>
                                </td>
                                <td>5 days</td>
                                <td>Oral</td>
                                <td>10 tablets</td>
                            </tr>
                            <tr>
                                <td>3</td>
                                <td>
                                    <div class="medicine-details">
                                        <span class="medicine-name truncate-text">Amoxicillin 500mg Capsules</span>
                                        <span class="medicine-instruction">- Take 1 capsule three times daily with food for bacterial infection</span>
                                    </div>
                                </td>
                                <td>10 days</td>
                                <td>Oral</td>
                                <td>30 capsules</td>
                            </tr>
                            <tr>
                                <td>4</td>
                                <td>
                                    <div class="medicine-details">
                                        <span class="medicine-name truncate-text">Loratadine 10mg Tablets</span>
                                        <span class="medicine-instruction">- Take 1 tablet once daily for allergy relief</span>
                                    </div>
                                </td>
                                <td>14 days</td>
                                <td>Oral</td>
                                <td>14 tablets</td>
                            </tr>
                            <tr>
                                <td>5</td>
                                <td>
                                    <div class="medicine-details">
                                        <span class="medicine-name truncate-text">Omeprazole 20mg Capsules</span>
                                        <span class="medicine-instruction">- Take 1 capsule once daily before breakfast for acid reflux</span>
                                    </div>
                                </td>
                                <td>28 days</td>
                                <td>Oral</td>
                                <td>28 capsules</td>
                            </tr>
                            <tr>
                                <td>6</td>
                                <td>
                                    <div class="medicine-details">
                                        <span class="medicine-name truncate-text">Metformin 500mg Tablets</span>
                                        <span class="medicine-instruction">- Take 1 tablet twice daily with meals for diabetes management</span>
                                    </div>
                                </td>
                                <td>30 days</td>
                                <td>Oral</td>
                                <td>60 tablets</td>
                            </tr>
                            <tr>
                                <td>7</td>
                                <td>
                                    <div class="medicine-details">
                                        <span class="medicine-name truncate-text">Simvastatin 20mg Tablets</span>
                                        <span class="medicine-instruction">- Take 1 tablet once daily in the evening for cholesterol control</span>
                                    </div>
                                </td>
                                <td>30 days</td>
                                <td>Oral</td>
                                <td>30 tablets</td>
                            </tr>
                            <tr>
                                <td>8</td>
                                <td>
                                    <div class="medicine-details">
                                        <span class="medicine-name truncate-text">Lisinopril 10mg Tablets</span>
                                        <span class="medicine-instruction">- Take 1 tablet once daily for blood pressure management</span>
                                    </div>
                                </td>
                                <td>30 days</td>
                                <td>Oral</td>
                                <td>30 tablets</td>
                            </tr>
                            <tr>
                                <td>9</td>
                                <td>
                                    <div class="medicine-details">
                                        <span class="medicine-name truncate-text">Atorvastatin 40mg Tablets</span>
                                        <span class="medicine-instruction">- Take 1 tablet once daily in the evening for high cholesterol</span>
                                    </div>
                                </td>
                                <td>30 days</td>
                                <td>Oral</td>
                                <td>30 tablets</td>
                            </tr>
                            <tr>
                                <td>10</td>
                                <td>
                                    <div class="medicine-details">
                                        <span class="medicine-name truncate-text">Amlodipine 5mg Tablets</span>
                                        <span class="medicine-instruction">- Take 1 tablet once daily for hypertension treatment</span>
                                    </div>
                                </td>
                                <td>30 days</td>
                                <td>Oral</td>
                                <td>30 tablets</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="prescribed-by">
            <div class="prescribed-by-title">Prescribed By</div>
            <div class="doctor-details">
                <table>
                    <tr>
                        <th>Name:</th>
                        <th>Registration No:</th>
                        <th>Qualifications:</th>
                    </tr>
                    <tr>
                        <td>Dr. Jane Smith</td>
                        <td>GMC - 1234567</td>
                        <td>MBBS, MD</td>
                    </tr>
                </table>
            </div>
        </div>

        <div class="qr-signature-container">
            <div class="qr-container">
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://sendscript.com/dispense" alt="QR Code">
                <p>Scan to Dispense</p>
            </div>
            <div class="signature-section">
                <p>This prescription has been signed using an advanced electronic signature</p>
                <p><strong>E-signature: Dr. Jane Smith</strong></p>
                <p><strong>Date and Time of signature:</strong> 15/12/2024, 14:30</p>
                <p>To verify (or) dispense the prescription visit: www.sendscript.com/dispense</p>
            </div>
        </div>

        <div class="footer-text">
            <p><strong>To the Pharmacist:</strong> SendScript is an online electronic prescription platform that connects prescribers direct to pharmacies. All of our Doctors & Prescribers hold full clinical registrations and are listed on their respective specialist registers. Medications are prescribed following a comprehensive assessment either face to face and Remote Consultations. We are grateful to you for accepting this prescription. Please do not hesitate to contact our support team if you have any queries.</p>
        </div>
    </div>

    <script>
        // Function to calculate if table fits in container and handle pagination
        function handleTablePagination() {
            const container = document.querySelector('.prescription-table-container');
            const table = document.querySelector('.prescription-table');
            const tbody = document.getElementById('prescription-tbody');
            const rows = tbody.querySelectorAll('tr');
            
            // Get container height
            const containerHeight = container.offsetHeight;
            const headerHeight = document.querySelector('.header').offsetHeight;
            const detailsHeight = document.querySelector('.details-container').offsetHeight;
            const prescribedByHeight = document.querySelector('.prescribed-by').offsetHeight;
            const qrSignatureHeight = document.querySelector('.qr-signature-container').offsetHeight;
            const footerHeight = document.querySelector('.footer-text').offsetHeight;
            
            // Calculate available height for table
            const availableHeight = containerHeight - headerHeight - detailsHeight - prescribedByHeight - qrSignatureHeight - footerHeight - 100; // 100px buffer
            
            // Calculate table header height
            const tableHeader = table.querySelector('thead');
            const headerRowHeight = tableHeader.offsetHeight;
            
            // Calculate available height for table body
            const availableBodyHeight = availableHeight - headerRowHeight;
            
            let currentHeight = 0;
            let currentPageRows = [];
            let allPages = [];
            
            rows.forEach((row, index) => {
                const rowHeight = row.offsetHeight;
                
                // If adding this row would exceed available height, start a new page
                if (currentHeight + rowHeight > availableBodyHeight && currentPageRows.length > 0) {
                    allPages.push([...currentPageRows]);
                    currentPageRows = [row];
                    currentHeight = rowHeight;
                } else {
                    currentPageRows.push(row);
                    currentHeight += rowHeight;
                }
            });
            
            // Add the last page if it has rows
            if (currentPageRows.length > 0) {
                allPages.push(currentPageRows);
            }
            
            // If we have multiple pages, create separate containers
            if (allPages.length > 1) {
                createMultiplePages(allPages);
            }
        }
        
        function createMultiplePages(allPages) {
            const originalContainer = document.querySelector('.prescription-table-container');
            const originalTable = document.querySelector('.prescription-table');
            const originalTbody = document.getElementById('prescription-tbody');
            
            // Clear the original container
            originalContainer.innerHTML = '';
            
            allPages.forEach((pageRows, pageIndex) => {
                // Create new page container
                const pageContainer = document.createElement('div');
                pageContainer.className = 'prescription-table-container';
                if (pageIndex > 0) {
                    pageContainer.classList.add('page-break');
                }
                
                // Create new table for this page
                const newTable = originalTable.cloneNode(true);
                const newTbody = newTable.querySelector('tbody');
                newTbody.innerHTML = '';
                
                // Add rows for this page
                pageRows.forEach(row => {
                    newTbody.appendChild(row.cloneNode(true));
                });
                
                // Create table wrapper
                const tableWrapper = document.createElement('div');
                tableWrapper.className = 'table-wrapper';
                
                const tableContent = document.createElement('div');
                tableContent.className = 'table-content';
                tableContent.appendChild(newTable);
                tableWrapper.appendChild(tableContent);
                pageContainer.appendChild(tableWrapper);
                
                // Insert the page container
                if (pageIndex === 0) {
                    originalContainer.parentNode.insertBefore(pageContainer, originalContainer);
                } else {
                    // Create a new PDF container for additional pages
                    const newPdfContainer = createNewPdfContainer(pageContainer, pageIndex);
                    originalContainer.parentNode.insertBefore(newPdfContainer, originalContainer);
                }
            });
            
            // Remove the original container
            originalContainer.remove();
        }
        
        function createNewPdfContainer(pageContainer, pageIndex) {
            const newPdfContainer = document.createElement('div');
            newPdfContainer.className = 'pdf-container prescription-page page-break';
            
            // Clone header
            const header = document.querySelector('.header').cloneNode(true);
            newPdfContainer.appendChild(header);
            
            // Clone details container
            const detailsContainer = document.querySelector('.details-container').cloneNode(true);
            newPdfContainer.appendChild(detailsContainer);
            
            // Add the prescription table container
            newPdfContainer.appendChild(pageContainer);
            
            // Clone prescribed by section
            const prescribedBy = document.querySelector('.prescribed-by').cloneNode(true);
            newPdfContainer.appendChild(prescribedBy);
            
            // Clone QR signature container
            const qrSignatureContainer = document.querySelector('.qr-signature-container').cloneNode(true);
            newPdfContainer.appendChild(qrSignatureContainer);
            
            // Clone footer
            const footer = document.querySelector('.footer-text').cloneNode(true);
            newPdfContainer.appendChild(footer);
            
            return newPdfContainer;
        }
        
        // Initialize pagination when page loads
        window.addEventListener('load', () => {
            setTimeout(handleTablePagination, 100);
        });
        
        // Recalculate on window resize
        window.addEventListener('resize', () => {
            setTimeout(handleTablePagination, 100);
        });
    </script>
</body>
</html>
